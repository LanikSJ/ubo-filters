#!/usr/bin/env bash

date=$(date +%Y%m%d)
olddate=$(cat filters/malware-domains.txt | grep "Last modified" | awk '{print $4}')

cd filters
../scripts/remove-lines.sh malware-domains.txt 15 >malware-domains-temp.txt && mv malware-domains-temp.txt malware-domains.txt
curl -L http://malwarepatrolexport-covid-19.s3-website.us-east-2.amazonaws.com/domains/domains.txt | sed -e 's/^/||/' -e 's/$/^/' | sort -d >>malware-domains.txt
sed -i "s/$olddate/"${date}01/g" malware-domains.txt
perl ../scripts/addChecksum.pl malware-domains.txt
perl ../scripts/sorter.pl malware-domains.txt
